name: Release y Seguimiento de Cambios

# Ejecuta cuando se publica un release en GitHub
on:
  release:
    types: [published]

jobs:
  release-tracking:
    name: ðŸŽ¯ Seguimiento de Cambios en Release
    runs-on: ubuntu-latest
    
    steps:
    # 1. Checkout del cÃ³digo
    - name: ðŸ“¥ Descargar cÃ³digo fuente
      uses: actions/checkout@v4
      
    # 2. Configurar la versiÃ³n del release
    - name: ðŸ·ï¸ Configurar VersiÃ³n del Release desde Tag
      run: echo "RELEASE_VERSION=${{ github.ref_name }}" >> $GITHUB_ENV
      
    # 3. Marcador de Deployment de Release en New Relic
    - name: ðŸ“Š Marcador de Deployment de Release en New Relic
      uses: newrelic/deployment-marker-action@v2.3.0
      with:
        apiKey: ${{ secrets.NEW_RELIC_API_KEY }}
        guid: ${{ secrets.NEW_RELIC_DEPLOYMENT_ENTITY_GUID }}
        version: "${{ env.RELEASE_VERSION }}"
        user: "${{ github.actor }}"
        description: "ðŸš€ Release ${{ env.RELEASE_VERSION }} publicado por ${{ github.actor }}"
        
    # 4. NotificaciÃ³n de Ã©xito
    - name: âœ… Resumen de Seguimiento de Release
      run: |
        echo "ðŸŽ‰ Release ${{ env.RELEASE_VERSION }} registrado exitosamente en New Relic"
        echo "ðŸ‘¤ Publicado por: ${{ github.actor }}"
        echo "ðŸ“Š Marcador de deployment creado para correlaciÃ³n de monitoreo"
        echo "ðŸ”— Revisa el dashboard de New Relic para anÃ¡lisis de impacto del deployment"